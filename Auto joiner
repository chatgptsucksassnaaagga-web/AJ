repeat task.wait() until game:IsLoaded()

-- SERVICES
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

-- RELAY
local RELAY_URL = "https://selections-impression-renaissance-paul.trycloudflare.com/servers"

-- CACHE
local SeenJobs = {}

-- CLEAN GUI
pcall(function()
    local g = CoreGui:FindFirstChild("Krypth AutoJoiner")
    if g then g:Destroy() end
end)

-- FORMATTERS
local function parseMPS(data)
    if typeof(data.mps) == "number" and data.mps > 0 then
        return data.mps
    end

    if typeof(data.money) == "string" then
        local num = tonumber(data.money:gsub("[^%d]", ""))
        if num and num > 0 then
            return num
        end
    end

    return nil
end

local function formatMoney(n)
    local s = tostring(math.floor(n))
    local r = s:reverse():gsub("(%d%d%d)", "%1,"):reverse()
    if r:sub(1,1) == "," then r = r:sub(2) end
    return "$" .. r .. "/s"
end

-- UI ROOT
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "Krypth AutoJoiner"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.AnchorPoint = Vector2.new(0.5,0.5)
Main.Position = UDim2.fromScale(0.5,0.5)
Main.Size = UDim2.fromScale(0.46,0.6)
Main.BackgroundColor3 = Color3.fromRGB(17,17,22)
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,20)

-- HEADER
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1,0,0,70)
Header.BackgroundTransparency = 1

local Title = Instance.new("TextLabel", Header)
Title.Position = UDim2.new(0,20,0,0)
Title.Size = UDim2.new(1,-100,1,0)
Title.Text = "ðŸ§  Krypth AutoJoiner"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 21
Title.TextColor3 = Color3.fromRGB(235,235,245)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1

-- SCROLL
local Scroll = Instance.new("ScrollingFrame", Main)
Scroll.Position = UDim2.new(0,18,0,80)
Scroll.Size = UDim2.new(1,-36,1,-98)
Scroll.CanvasSize = UDim2.new()
Scroll.ScrollBarThickness = 6
Scroll.BackgroundTransparency = 1

local Layout = Instance.new("UIListLayout", Scroll)
Layout.Padding = UDim.new(0,12)

Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Scroll.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 20)
end)

-- ROW
local function createRow(data)
    if not data.jobId or SeenJobs[data.jobId] then return end

    local mps = parseMPS(data)
    if not mps then return end

    SeenJobs[data.jobId] = true

    local brainrot = tostring(
        data.brainrot or data.bestBrainrot or "Unknown"
    )

    local Row = Instance.new("Frame", Scroll)
    Row.Size = UDim2.new(1,0,0,68)
    Row.BackgroundColor3 = Color3.fromRGB(23,23,30)
    Row.BorderSizePixel = 0
    Instance.new("UICorner", Row).CornerRadius = UDim.new(0,16)

    local Text = Instance.new("TextLabel", Row)
    Text.Position = UDim2.new(0,16,0,6)
    Text.Size = UDim2.new(0.6,0,1,-12)
    Text.TextWrapped = true
    Text.TextXAlignment = Enum.TextXAlignment.Left
    Text.TextYAlignment = Enum.TextYAlignment.Center
    Text.Font = Enum.Font.Gotham
    Text.TextSize = 13
    Text.TextColor3 = Color3.fromRGB(220,220,230)
    Text.BackgroundTransparency = 1
    Text.Text = brainrot .. "\n" .. formatMoney(mps)

    local Join = Instance.new("TextButton", Row)
    Join.Size = UDim2.new(0,120,0,38)
    Join.Position = UDim2.new(1,-140,0.5,-19)
    Join.Text = "JOIN"
    Join.Font = Enum.Font.GothamBold
    Join.TextSize = 14
    Join.TextColor3 = Color3.fromRGB(18,18,22)
    Join.BackgroundColor3 = Color3.fromRGB(45,200,125)
    Join.BorderSizePixel = 0
    Instance.new("UICorner", Join).CornerRadius = UDim.new(0,12)

    Join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            data.placeId,
            data.jobId,
            LocalPlayer
        )
    end)
end

-- FETCH LOOP
task.spawn(function()
    while true do
        task.wait(3)

        local ok, res = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(RELAY_URL))
        end)

        if ok and type(res) == "table" then
            for _, server in ipairs(res) do
                createRow(server)
            end
        end
    end
end)
