local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local RELAY_URL = "http://localhost:3000/servers"

-- GUI
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "BrainrotJoiner"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.45, 0.5)
frame.Position = UDim2.fromScale(0.275, 0.25)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.fromScale(1, 0.12)
title.Text = "ðŸ§  Brainrot Joiner"
title.TextScaled = true
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1,1,1)

local layout = Instance.new("UIListLayout", frame)
layout.Padding = UDim.new(0, 8)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top

local function addServer(s)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.fromScale(0.9, 0.13)
    btn.TextScaled = true
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.new(1,1,1)

    btn.Text =
        s.bestBrainrot ..
        " | $" .. math.floor(s.mps) .. "/s" ..
        " | " .. s.players .. "/" .. s.maxPlayers

    btn.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            s.placeId,
            s.jobId,
            player
        )
    end)
end

-- refresh loop
task.spawn(function()
    while true do
        task.wait(8)

        frame:ClearAllChildren()
        title.Parent = frame
        layout.Parent = frame

        local ok, servers = pcall(function()
            return HttpService:JSONDecode(
                game:HttpGet(RELAY_URL)
            )
        end)

        if ok then
            for _,s in ipairs(servers) do
                addServer(s)
            end
        end
    end
end)
