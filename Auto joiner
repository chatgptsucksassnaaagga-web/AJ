local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Change this to your IP address
local RELAY_URL = "http://10.173.69.78:3000/servers"

--------------------------------------------------
-- GUI
--------------------------------------------------
local gui = Instance.new("ScreenGui")
gui.Name = "BrainrotJoiner"
gui.ResetOnSpawn = false
gui.Parent = player.PlayerGui

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.42, 0.5)
main.Position = UDim2.fromScale(0.29, 0.25)
main.BackgroundColor3 = Color3.fromRGB(20,20,20)
main.BorderSizePixel = 0

local corner = Instance.new("UICorner", main)
corner.CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.fromScale(1, 0.12)
title.Text = "ðŸ§  Brainrot Server Joiner"
title.TextScaled = true
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255,255,255)

--------------------------------------------------
-- Scroll list
--------------------------------------------------
local list = Instance.new("ScrollingFrame", main)
list.Position = UDim2.fromScale(0, 0.14)
list.Size = UDim2.fromScale(1, 0.86)
list.CanvasSize = UDim2.new(0,0,0,0)
list.ScrollBarImageTransparency = 0.2
list.BackgroundTransparency = 1
list.BorderSizePixel = 0
list.AutomaticCanvasSize = Enum.AutomaticSize.Y

local layout = Instance.new("UIListLayout", list)
layout.Padding = UDim.new(0, 8)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

--------------------------------------------------
-- Button template
--------------------------------------------------
local function createButton(data)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.fromScale(0.92, 0.12)
    btn.BackgroundColor3 = Color3.fromRGB(35,35,35)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextScaled = true
    btn.AutoButtonColor = true
    btn.TextWrapped = true

    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

    btn.Text =
        data.bestBrainrot ..
        "\n$" .. math.floor(data.mps) .. "/s" ..
        "  |  " .. data.players .. "/" .. data.maxPlayers

    btn.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            data.placeId,
            data.jobId,
            player
        )
    end)

    btn.Parent = list
end

--------------------------------------------------
-- Refresh loop
--------------------------------------------------
task.spawn(function()
    while true do
        task.wait(8)

        -- clear old buttons only
        for _,child in ipairs(list:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end

        local ok, servers = pcall(function()
            return HttpService:JSONDecode(
                game:HttpGet(RELAY_URL)
            )
        end)

        if ok and type(servers) == "table" then
            for _,s in ipairs(servers) do
                createButton(s)
            end
        end
    end
end)
