--====================================
-- Krypth AutoJoiner GUI (FINAL FIX)
--====================================

repeat task.wait() until game:IsLoaded()

-- ===== CLEAN GUI =====
local CoreGui = game:GetService("CoreGui")
for _,v in ipairs(CoreGui:GetChildren()) do
    if v.Name == "Krypth AutoJoiner" then
        v:Destroy()
    end
end

-- ===== CONFIG =====
local RELAY_URL = "https://selections-impression-renaissance-paul.trycloudflare.com/servers"

-- ===== SERVICES =====
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer

-- ===== HELPERS =====
local function formatMoney(n)
    n = math.floor(n)
    local s = tostring(n):reverse():gsub("(%d%d%d)", "%1,"):reverse()
    if s:sub(1,1) == "," then s = s:sub(2) end
    return "$"..s.."/s"
end

local function tween(o,p,t)
    TweenService:Create(
        o,
        TweenInfo.new(t or 0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
        p
    ):Play()
end

-- ===== GUI ROOT =====
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "Krypth AutoJoiner"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

local Shadow = Instance.new("ImageLabel", ScreenGui)
Shadow.AnchorPoint = Vector2.new(0.5,0.5)
Shadow.Position = UDim2.fromScale(0.5,0.5)
Shadow.Size = UDim2.fromScale(0.5,0.65)
Shadow.Image = "rbxassetid://1316045217"
Shadow.ImageTransparency = 0.45
Shadow.BackgroundTransparency = 1

local Main = Instance.new("Frame", ScreenGui)
Main.AnchorPoint = Vector2.new(0.5,0.5)
Main.Position = UDim2.fromScale(0.5,0.5)
Main.Size = UDim2.fromScale(0.46,0.6)
Main.BackgroundColor3 = Color3.fromRGB(17,17,22)
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,20)

-- ===== HEADER =====
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1,0,0,72)
Header.BackgroundTransparency = 1

local Title = Instance.new("TextLabel", Header)
Title.Position = UDim2.new(0,22,0,0)
Title.Size = UDim2.new(1,-120,1,0)
Title.Text = "ðŸ§  Krypth AutoJoiner"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 22
Title.TextColor3 = Color3.fromRGB(235,235,245)
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextYAlignment = Enum.TextYAlignment.Center

local MinBtn = Instance.new("TextButton", Header)
MinBtn.Size = UDim2.new(0,38,0,38)
MinBtn.Position = UDim2.new(1,-54,0.5,-19)
MinBtn.Text = "â€”"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 22
MinBtn.TextColor3 = Color3.fromRGB(235,235,245)
MinBtn.BackgroundColor3 = Color3.fromRGB(30,30,38)
MinBtn.BorderSizePixel = 0
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0,12)

-- ===== SCROLL =====
local Scroll = Instance.new("ScrollingFrame", Main)
Scroll.Position = UDim2.new(0,18,0,90)
Scroll.Size = UDim2.new(1,-36,1,-110)
Scroll.CanvasSize = UDim2.new(0,0,0,0)
Scroll.ScrollBarThickness = 6
Scroll.BackgroundTransparency = 1

local Layout = Instance.new("UIListLayout", Scroll)
Layout.Padding = UDim.new(0,12)

Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Scroll.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 20)
end)

-- ===== ROW =====
local function createRow(entry)
    local brainrot =
        entry.bestBrainrot
        or entry.brainrot
        or "Unknown Brainrot"

    local money =
        entry.money
        or (entry.mps and formatMoney(entry.mps))
        or "$0/s"

    local players = ""
    if entry.players and entry.maxPlayers then
        players = entry.players.."/"..entry.maxPlayers
    end

    local Row = Instance.new("Frame", Scroll)
    Row.Size = UDim2.new(1,0,0,78)
    Row.BackgroundColor3 = Color3.fromRGB(23,23,30)
    Row.BorderSizePixel = 0
    Instance.new("UICorner", Row).CornerRadius = UDim.new(0,16)

    -- NAME
    local Name = Instance.new("TextLabel", Row)
    Name.Position = UDim2.new(0,20,0,10)
    Name.Size = UDim2.new(0.65,-20,0,26)
    Name.Text = brainrot
    Name.Font = Enum.Font.GothamBold
    Name.TextSize = 15
    Name.TextColor3 = Color3.fromRGB(235,235,245)
    Name.BackgroundTransparency = 1
    Name.TextXAlignment = Enum.TextXAlignment.Left
    Name.TextWrapped = true

    -- MONEY
    local Money = Instance.new("TextLabel", Row)
    Money.Position = UDim2.new(0,20,0,38)
    Money.Size = UDim2.new(0.65,-20,0,20)
    Money.Text = money .. (players ~= "" and ("  ("..players..")") or "")
    Money.Font = Enum.Font.Gotham
    Money.TextSize = 13
    Money.TextColor3 = Color3.fromRGB(180,180,190)
    Money.BackgroundTransparency = 1
    Money.TextXAlignment = Enum.TextXAlignment.Left

    -- JOIN
    local Join = Instance.new("TextButton", Row)
    Join.Size = UDim2.new(0,120,0,40)
    Join.Position = UDim2.new(1,-140,0.5,-20)
    Join.Text = "JOIN"
    Join.Font = Enum.Font.GothamBold
    Join.TextSize = 14
    Join.TextColor3 = Color3.fromRGB(18,18,22)
    Join.BackgroundColor3 = Color3.fromRGB(45,200,125)
    Join.BorderSizePixel = 0
    Instance.new("UICorner", Join).CornerRadius = UDim.new(0,12)

    Join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            entry.placeId,
            entry.jobId,
            LocalPlayer
        )
    end)
end

-- ===== FETCH LOOP =====
task.spawn(function()
    while true do
        task.wait(3)

        for _,c in ipairs(Scroll:GetChildren()) do
            if c:IsA("Frame") then
                c:Destroy()
            end
        end

        local ok, data = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(RELAY_URL))
        end)

        if ok and type(data) == "table" then
            for _,entry in ipairs(data) do
                if entry.jobId and entry.placeId then
                    createRow(entry)
                end
            end
        end
    end
end)

-- ===== MINIMIZE =====
local minimized = false
local fullSize = Main.Size

MinBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        tween(Main,{Size=UDim2.new(fullSize.X.Scale,0,0,72)},0.35)
        Scroll.Visible = false
    else
        tween(Main,{Size=fullSize},0.4)
        Scroll.Visible = true
    end
end)
